Summary,Issue Type,Description,Story Points,Priority,Labels
"Sprint 2: GestiÃ³n de Usuarios",Epic,"CRUD completo de usuarios con validaciones, excepciones personalizadas y testing unitario e integraciÃ³n.",,High,epic
"USER-01: Crear entidad User",Story,"## ðŸŽ¯ Objetivo
Crear la entidad User que representa a los usuarios de la aplicaciÃ³n.

---

## ðŸ“‹ EspecificaciÃ³n funcional

**Entidad User:**
- Hereda de BaseEntity
- nombre: String (Ãºnico, entre 2 y 50 caracteres)

**Tabla:** app_user (no usar ""user"" porque es palabra reservada en SQL)

**Repository:**
- findByNombre(String nombre): Optional<User>
- existsByNombre(String nombre): boolean
- findAllByOrderByNombreAsc(): List<User>

---

## âœ… Criterios de aceptaciÃ³n

- [ ] Entidad User creada heredando de BaseEntity
- [ ] Tabla nombrada como app_user
- [ ] Constraint UNIQUE en el campo nombre
- [ ] UserRepository creado con los mÃ©todos especificados
- [ ] Al arrancar, no hay errores de mapeo JPA

---

## ðŸ§ª Testing requerido

**Tests de repositorio (UserRepositoryTest con @DataJpaTest):**
- shouldFindByNombre
- shouldReturnTrueWhenUserExists
- shouldFindAllUsersOrderedByName

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| jakarta.persistence | SPRINGBOOT2-A-SPRINGBOOT3.md - SecciÃ³n 1 |
| @DataJpaTest | TESTING.md - SecciÃ³n 6 |

---

## ðŸ’¡ Pistas

1. @Table(name = ""app_user"") evita conflicto con palabra reservada
2. La constraint unique se puede definir con @Column(unique = true)
3. Spring Data genera implementaciÃ³n por convenciÃ³n de nombres

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-01",2,High,"backend,entity,sprint2"
"USER-02: GET /api/users - Listar usuarios",Story,"## ðŸŽ¯ Objetivo
Implementar endpoint para listar todos los usuarios ordenados alfabÃ©ticamente.

---

## ðŸ“‹ EspecificaciÃ³n funcional

| MÃ©todo | Endpoint | Response |
|--------|----------|----------|
| GET | /api/users | 200 + Lista de UserResponse |

**UserResponse (Record):**
- id: Long
- nombre: String
- fechaCreacion: LocalDateTime

**Clases a crear:**
- UserResponse (dto/response)
- UserMapper (mapper)
- UserService (service)
- UserController (controller)

---

## âœ… Criterios de aceptaciÃ³n

- [ ] GET /api/users devuelve lista de usuarios ordenados por nombre
- [ ] Si no hay usuarios, devuelve lista vacÃ­a (no 404)
- [ ] UserResponse incluye fechaCreacion del BaseEntity
- [ ] Endpoint documentado en Swagger con @Tag y @Operation

---

## ðŸ§ª Testing requerido

**Tests unitarios (UserServiceTest):**
- shouldReturnAllUsersOrdered
- shouldReturnEmptyListWhenNoUsers

**Tests de controller (UserControllerTest):**
- shouldReturn200WithUsers
- shouldReturn200WithEmptyList

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| Records | JAVA8-A-JAVA17.md - SecciÃ³n 1 |
| Stream.toList() | JAVA8-A-JAVA17.md - SecciÃ³n 7 |

---

## ðŸ’¡ Pistas

1. El mapper accede a getCreatedAt() de BaseEntity para fechaCreacion
2. @Transactional(readOnly = true) en el Service para operaciones de lectura
3. Lista vacÃ­a es vÃ¡lida, no lances excepciÃ³n si no hay usuarios

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-02",2,High,"backend,api,sprint2"
"USER-03: POST /api/users - Crear usuario",Story,"## ðŸŽ¯ Objetivo
Implementar endpoint para crear usuarios con validaciones y manejo de duplicados.

---

## ðŸ“‹ EspecificaciÃ³n funcional

| MÃ©todo | Endpoint | Request Body | Response |
|--------|----------|--------------|----------|
| POST | /api/users | CreateUserRequest | 201 + UserResponse |

**CreateUserRequest (Record con validaciones):**
- nombre: String (@NotBlank, @Size min=2 max=50)

**Reglas de negocio:**
- El nombre es obligatorio y debe tener entre 2 y 50 caracteres
- El nombre debe ser Ãºnico (case sensitive)
- Los espacios al inicio/final se eliminan automÃ¡ticamente (trim)

---

## âœ… Criterios de aceptaciÃ³n

| Caso | Input | Output esperado |
|------|-------|-----------------|
| Usuario vÃ¡lido | {""nombre"": ""Carlos""} | 201 + UserResponse con id |
| Nombre vacÃ­o | {""nombre"": """"} | 400 + VALIDATION_ERROR |
| Nombre muy corto | {""nombre"": ""A""} | 400 + VALIDATION_ERROR |
| Nombre muy largo | {""nombre"": ""X"" * 51} | 400 + VALIDATION_ERROR |
| Nombre duplicado | {""nombre"": ""Carlos""} (existe) | 409 + DUPLICATE_ENTITY |
| Nombre con espacios | {""nombre"": ""  Carlos  ""} | 201 + nombre=""Carlos"" |

---

## ðŸ§ª Testing requerido

**Tests unitarios (UserServiceTest):**
- shouldCreateUser_WhenNameIsUnique
- shouldThrowDuplicateException_WhenNameExists
- shouldTrimSpaces_WhenNameHasSpaces

**Tests de controller (UserControllerTest):**
- shouldReturn201_WhenValidRequest
- shouldReturn400_WhenNameIsBlank
- shouldReturn400_WhenNameTooShort
- shouldReturn409_WhenNameIsDuplicate

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| Records con validaciones | JAVA8-A-JAVA17.md - SecciÃ³n 1 |
| jakarta.validation | SPRINGBOOT2-A-SPRINGBOOT3.md - SecciÃ³n 4 |
| AssertJ excepciones | TESTING.md - SecciÃ³n 4 |

---

## ðŸ’¡ Pistas

1. @Valid en el parÃ¡metro del controller activa las validaciones
2. Aplica trim() al nombre ANTES de verificar duplicados
3. ResponseEntity.status(HttpStatus.CREATED) para devolver 201
4. El mapper debe aplicar trim() al convertir request a entity

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-03",3,High,"backend,api,sprint2"
"USER-04: GET /api/users/{id} - Obtener usuario por ID",Story,"## ðŸŽ¯ Objetivo
Implementar endpoint para obtener un usuario especÃ­fico por su ID.

---

## ðŸ“‹ EspecificaciÃ³n funcional

| MÃ©todo | Endpoint | Response |
|--------|----------|----------|
| GET | /api/users/{id} | 200 + UserResponse |
| GET | /api/users/{id} (no existe) | 404 + ErrorResponse |

---

## âœ… Criterios de aceptaciÃ³n

- [ ] GET /api/users/1 devuelve el usuario con id 1
- [ ] GET /api/users/999 devuelve 404 con cÃ³digo NOT_FOUND
- [ ] El ErrorResponse incluye mensaje descriptivo con el id buscado

---

## ðŸ§ª Testing requerido

**Tests unitarios (UserServiceTest):**
- shouldReturnUser_WhenIdExists
- shouldThrowNotFound_WhenIdDoesNotExist

**Tests de controller (UserControllerTest):**
- shouldReturn200_WhenUserExists
- shouldReturn404_WhenUserNotFound

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| Optional.orElseThrow | JAVA8-A-JAVA17.md - SecciÃ³n 8 |

---

## ðŸ’¡ Pistas

1. @PathVariable Long id captura el parÃ¡metro de la URL
2. repository.findById() devuelve Optional<User>
3. Usa orElseThrow con EntityNotFoundException

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-04",1,High,"backend,api,sprint2"
"USER-05: PUT /api/users/{id} - Actualizar usuario",Story,"## ðŸŽ¯ Objetivo
Implementar endpoint para actualizar el nombre de un usuario existente.

---

## ðŸ“‹ EspecificaciÃ³n funcional

| MÃ©todo | Endpoint | Request Body | Response |
|--------|----------|--------------|----------|
| PUT | /api/users/{id} | UpdateUserRequest | 200 + UserResponse |

**UpdateUserRequest (Record con validaciones):**
- nombre: String (@NotBlank, @Size min=2 max=50)

**Reglas de negocio:**
- El usuario debe existir
- El nuevo nombre no puede estar en uso por OTRO usuario
- Si el nombre es igual al actual, es vÃ¡lido (no es duplicado consigo mismo)
- Se aplica trim() al nombre

---

## âœ… Criterios de aceptaciÃ³n

| Caso | Input | Output esperado |
|------|-------|-----------------|
| ActualizaciÃ³n vÃ¡lida | PUT /api/users/1 {""nombre"": ""NuevoNombre""} | 200 + UserResponse |
| Usuario no existe | PUT /api/users/999 | 404 + NOT_FOUND |
| Nombre en uso por otro | PUT /api/users/1 {""nombre"": ""NombreDeOtro""} | 409 + DUPLICATE_ENTITY |
| Mismo nombre (sin cambio) | PUT /api/users/1 {""nombre"": ""MismoNombre""} | 200 + UserResponse |
| Nombre invÃ¡lido | PUT /api/users/1 {""nombre"": """"} | 400 + VALIDATION_ERROR |

---

## ðŸ§ª Testing requerido

**Tests unitarios (UserServiceTest):**
- shouldUpdateUser_WhenNewNameIsUnique
- shouldUpdateUser_WhenNameUnchanged
- shouldThrowNotFound_WhenUserDoesNotExist
- shouldThrowDuplicate_WhenNameUsedByAnother

**Tests de controller (UserControllerTest):**
- shouldReturn200_WhenUpdateSuccessful
- shouldReturn404_WhenUserToUpdateNotFound
- shouldReturn409_WhenNewNameIsDuplicate

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| Records | JAVA8-A-JAVA17.md - SecciÃ³n 1 |
| Pattern matching instanceof | JAVA8-A-JAVA17.md - SecciÃ³n 3 |

---

## ðŸ’¡ Pistas

1. Primero buscar el usuario por id (404 si no existe)
2. Para verificar duplicado: buscar por nombre y comprobar que el id sea diferente
3. Una forma: findByNombre().filter(u -> !u.getId().equals(id)).isPresent()
4. Otra forma: crear mÃ©todo en repository existsByNombreAndIdNot(nombre, id)

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-05",2,High,"backend,api,sprint2"
"USER-06: DELETE /api/users/{id} - Eliminar usuario",Story,"## ðŸŽ¯ Objetivo
Implementar endpoint para eliminar un usuario.

---

## ðŸ“‹ EspecificaciÃ³n funcional

| MÃ©todo | Endpoint | Response |
|--------|----------|----------|
| DELETE | /api/users/{id} | 204 No Content |
| DELETE | /api/users/{id} (no existe) | 404 + ErrorResponse |

**Comportamiento:**
- Si el usuario existe, eliminarlo y devolver 204 (sin body)
- Si no existe, devolver 404

**Nota sobre cascade:**
En sprints posteriores, cuando el usuario tenga tierlists asociadas, se eliminarÃ¡n en cascada. Por ahora solo se elimina el usuario.

---

## âœ… Criterios de aceptaciÃ³n

- [ ] DELETE /api/users/1 elimina el usuario y devuelve 204
- [ ] DELETE /api/users/999 devuelve 404 si no existe
- [ ] Verificar que el usuario realmente se eliminÃ³ de la BD

---

## ðŸ§ª Testing requerido

**Tests unitarios (UserServiceTest):**
- shouldDeleteUser_WhenExists
- shouldThrowNotFound_WhenUserToDeleteDoesNotExist

**Tests de controller (UserControllerTest):**
- shouldReturn204_WhenDeleteSuccessful
- shouldReturn404_WhenUserToDeleteNotFound

**Tests de integraciÃ³n (UserControllerIT):**
- shouldDeleteUserAndVerifyNotInDatabase

---

## ðŸ”— Referencias

| Concepto | Documento |
|----------|-----------|
| deleteById comportamiento | SPRINGBOOT2-A-SPRINGBOOT3.md - SecciÃ³n 3 |

---

## ðŸ’¡ Pistas

1. Verificar existencia antes de eliminar (Spring Boot 3 no lanza excepciÃ³n si no existe)
2. ResponseEntity.noContent().build() devuelve 204 sin body
3. El test de integraciÃ³n debe crear usuario, eliminarlo y verificar que no existe

---

## ðŸ“– CÃ³digo de referencia

Ver: SPRINT-2-soluciones.md â†’ USER-06",2,Medium,"backend,api,sprint2"
